# oc_client_back

## Установка
1. склонировать репозиторий
2. npm install
3. настроить файлы config: development.yaml, staging.yaml и production.yaml
4. Для запуска в development-окружении: npm run development
5. Для запуска в окружениях staging | production:
    * создать пустую папку build в корне проекта
    * npm run build
    * npm run staging | production

## Тестирование
1. Установить mocha глобально: npm i mocha -g
2. Тестирование:
    * запустить сервер в требуемом окружении (development | staging | production)
    * запустить тестирование npm run testDev | testStage | testProd

## Страница тестирования API
По адресу /api/testAPI доступен интерфейс тестирования всех функций API.<br/>
Все фронтэнд-функции для работы с API см. в /public/api/testAPI.js

## Tag & Source
Для Source все точно также как для Tag через /api/source/... и все поля tag заменить на source.

### POST /api/tag/find
Конвертация tag в tagID и обратно.<br/>
Принимает строковый или числовой массив tag.<br/>
Если массив полностью числовой, считается, что это массив tagID, в этом случае возвращает массив tag,
иначе возвращает массив tagID (и только найденные совпадения)<br/>
!Входной и возвратный массив не соответствуют друг другу поэлементно!<br/>
Ненайденный tag или tagID (см. пример tagID=100) ничего не возвращает.
```
 [ "дети","животные","Москва","лекарства" ] => [ 8,7,6,9 ]
 [ 9,8,7,6,100 ] => [ "животные","дети","Москва","лекарства" ]
 [ 100 ] => []
```

### GET /api/all/:include
Получение списка тегов из БД в порядке релевантности.<br/>
/api/all - вернет все теги из базы
```
[
    "tag1",
    "tag3",
    "dsds",
    "спасение",
    "животные",
    "Москва",
    "дети",
    "лекарства"
]
```
?limit=3 - установит лимит в 3 тега
```
[
    "tag1",
    "tag3",
    "dsds"
]
```
/api/all/ва - вернет теги, которые содержат "ва"
```
[
    "Москва",
    "лекарства"
]
```

### POST /api/tag/add
Добавление тэгов.<br/>
Принимает строковый массив tag.<br/>
Возвращает массив записей созданных в БД.

### POST /api/tag/edit
Редактирование тэгов.<br/>
Принимает строковый массив tag из 2 элементов: [oldTagValue, newTagValue].<br/>
Возвращает результат редактирования в БД.
```
    ["asd","спасение"] -> изменит tag "asd" на "спасение"
```

### POST /api/tag/del
Удаление тэгов.<br/>
Принимает строковый или числовой массив tag.<br/>
Если массив полностью числовой, считается, что это массив ID тэгов и удаление производится по найденным tagID<br/>
Возвращает результат удаления в БД.

## Settings
Настройки для сети DAPP - адреса организаций и abi смарт-контрактов.

### POST /api/settings/setOrganizationList
Сохраняет настройки сети<br/>
Принимает 3 обязательных поля: type, list, abis<br/>
type - `0` или `-1`. 0 - настройки по умолчанию. -1 - настройки для dev-окружения.
list - строковый массив адресов организаций
abis - объект с обязательными полями { Organization, CharityEvent, IncomingDonation, OpenCharityToken },
в которых передаются abi.<br/>
Возвращает 'Ok'.

### GET /api/settings/getOrganizationList/:type
Получение настроек сети<br/>
type - `0` или `-1`. 0 - настройки по умолчанию. -1 - настройки для dev-окружения.
Возвращает { type, list, abis }